!function(){"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){var t;e.g.importScripts&&(t=e.g.location+"");var o=e.g.document;if(!t&&o&&(o.currentScript&&"SCRIPT"===o.currentScript.tagName.toUpperCase()&&(t=o.currentScript.src),!t)){var r=o.getElementsByTagName("script");if(r.length)for(var a=r.length-1;a>-1&&(!t||!/^http(s?):/.test(t));)t=r[a--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t}();const t=(e,t="flex")=>{t!==window.getComputedStyle(e).display&&(e.style.display=t)},o=e=>{"none"!==window.getComputedStyle(e).display&&(e.style.display="none")},r=(e,t,o=null,r=!1)=>{if(!r)return e.querySelector(t);if(!o)return Array.from(e.querySelectorAll(t));const a=Array.from(e.querySelectorAll(t));return o&&a.forEach(o),a},a=e=>Object.fromEntries(new FormData(e)),n=(e,t="",o="",r=null)=>{const a=document.createElement(e);return t&&a.classList.add(...t.trim().split(/\s+/)),o&&l(a,o),r&&r.appendChild(a),a},s=(e,t)=>{const o=e.querySelector(t);o&&o.remove()},i=(e,t)=>setTimeout((()=>e.remove()),t),c=e=>e.reset(),l=(e,t)=>e.textContent=t,d=["greenyellow","purple","orangered","tomato","cyan","chocolate","pink","yellow","green","black","violet","darkcyan","blue"],u=e=>e.charAt(0).toUpperCase()+e.slice(1),m=Array.from(r(document.body,"[data-container]",null,!0)),p={},h=(e,t,o,r,a,n,s,i)=>Object.assign(p,{showContainers:e||null,excludes:t||[7,8],display:o||"flex",titleEl:r||null,title:a||"",useOverlay:void 0===n||n,useModal:void 0!==s&&s,textButtonSubmit:i||""});var b=function(){const e=e=>document.querySelector(`.${e}`),t=e=>document.getElementById(e),o=t("overlay"),r=t("sign"),a=t("log-in"),n=e("close-modal"),s=t("form"),i=e("modal"),c=t("modal-title"),l=t("btn-form"),d=t("add-book"),u=e("header__nickname"),m=t("logout"),p=t("nickname"),h=e("main__group"),b=t("library"),f=t("title-section-library"),g=t("dashboard"),y=document.querySelector('button[data-fetch="books"]'),w=document.querySelector('button[data-fetch="profile"]'),k=document.querySelector('button[data-fetch="notifications"]'),v=t("title-section-dashboard"),E=i.querySelector(".visibility"),_=t("form-edit"),C=document.querySelector("fieldset");return{overlay:o,singBTN:r,logBTN:a,closeModal:n,form:s,modal:i,headerNickname:u,btnLogout:m,nickname:p,modalTitle:c,btnSubmitForm:l,groupLibraryBTN:h,titleLibrary:f,addBookBTN:d,buttonGetBooks:y,dashboard:g,buttonProfile:w,titleDashboard:v,eyeVisibilityForm:E,formEdit:_,library:b,characters:document.querySelectorAll(".characters-value"),fieldsetFormEdit:C,buttonNotifications:k}}(),f=e.p+"img/bookb0c6a69926a4632670ef.png";class g{static user=e=>{const{name:t,fullname:o,city:r,state:a,books:s}=e,i=n("DIV","item appear"),c=n("DIV","item__name","",i);var l;n("P","item__name--user",t,c),n("SPAN","item__name--profile","",c).style.background=`radial-gradient(circle, ${l=d,l[Math.floor(Math.random()*l.length)]}, whitesmoke)`;const u=n("DIV","item__info","",i);return o&&n("P","",`Fullname: ${o}`,u),r&&n("P","",a?`City: ${r}, ${a}`:`City: ${r}`,u),s&&n("P","item__info--countbooks",`Books: ${s}`,u),i};static book=e=>{const{name:t,description:o,user:r}=e,a=n("DIV","item appear"),s=n("DIV","item__name","",a),i=(n("P","item__name--user",u(t),s),n("DIV","item__name--img-book","",s)),c=n("IMG","","",i);Object.assign(c,{src:f,loading:"lazy",alt:""});const l=n("DIV","item__info","",a);return o&&n("P","",`Description: ${o}`,l),n("P","item__info--book-from",`From: ${r}`,l),a.dataset.book=t,a.dataset.from=r,a};static trader=e=>{const{book:t,userReceiver:o,userSender:r}=e,a=n("DIV","trader appear"),s=n("DIV","trader__requester","",a);n("P","","Requester:",s),n("P","trader__requester--label",r,s),n("p","trader__book",t,a);const i=n("DIV","trader__from","",a);return n("P","","From:",i),n("P","trader__from--label",o,i),a};static bookDashboard=e=>{const{name:t,description:o}=e,r=n("LI","appear");return n("P","with-label",t,r),n("P","",o,r),n("button","with-label with-label__delete","Delete",r).dataset.action="delete-book",r.dataset.book=t,r};static requestedBookDashboard=e=>{const{book:t,userReceiver:o,status:r}=e,a=n("LI","appear");a.dataset.book=t,n("P","with-label",t,a),n("P","with-label with-label__from","From: "+o,a);const s=n("span","with-label with-label__status",`Status: ${r}`,a);return"pending"===r&&(n("button","with-label with-label__delete","Cancel",a).dataset.action="cancel-trader",s.style.backgroundColor="goldenrod"),a};static notifications=({book:e,message:t,messageInput:o,sender:r,type:a})=>{const s=n("LI","notification appear");if(s.dataset.request=e,s.dataset.type=a,n("span","notification__title",t+"!",s),"request"===a){const t=n("DIV","notification__block","",s);n("p","with-label with-label__from",r,t),n("span","notification__wants","wants",t),n("p","with-label",e,t),o&&n("sppan","notification__message",`From the requester: ${o}`,s);const a=n("DIV","notification__button","",s),i=n("BUTTON","with-label with-label__accept","Accept Exchange",a),c=n("BUTTON","with-label with-label__delete","Decline",a);i.dataset.action="resolve-trader",c.dataset.action="reject-trader"}else{const e=n("BUTTON","with-label with-label__delete","OK",s);e.style.alignSelf="flex-end",e.dataset.action="delete-notification"}return s};static popupConfirm=e=>new Promise(((t,o)=>{const r=n("DIV","overlay-popup","",document.body),a=n("DIV","popup appear","",r),s=(n("P","",e,a),n("DIV","","",a)),i=n("BUTTON","btn","Yes",s),c=n("BUTTON","btn","Cancel",s);i.onclick=()=>t(r),c.onclick=()=>o(r)}));static messageDefault=()=>n("P","msg-default","Nothing to show here right now")}var y=new class{showError=(e,t,o)=>{if(!e)return;s(t,".error");const r=n("P","error",e);t.insertBefore(r,o),i(r,4e3)};showToast=(e,t=!1)=>{if(!e)return;s(document.body,".toast"),s(document.body,".toast-error");const o=n("DIV",t?"toast-error":"toast",e,document.body);i(o,5e3)};showNickname=e=>{t(b.headerNickname),b.nickname.style.whiteSpace="pre",l(b.nickname,` ${e}, `)};showFeedbackSuccessfuly=(e,t=!0,o=!0)=>{const{user:r}=e;o&&this.showToast(e.message),t&&b.closeModal.click(),r&&(r.type&&"login"===r.type?(this.showNickname(r.name),r.notifications&&r.notifications.length&&this.showToast("You have new notifications. Please check your dashboard"),b.buttonGetBooks.click()):"update-books"===r.type?b.buttonGetBooks.click():"notification"===r.type&&(b.buttonNotifications.click(),b.buttonGetBooks.click()))};toggleModalOrContainer=(e="open",a=null)=>{if("open"===e){const{excludes:e,showContainers:r,display:n,titleEl:s,title:i,useOverlay:c,useModal:d,textButtonSubmit:u}=a,p=new Set([...e]),h=new Set(Array.isArray(r)?r:[Number(r)]);s&&l(s,i),c&&t(b.overlay,"block"),d&&(t(b.modal,"block"),l(b.btnSubmitForm,u)),m.forEach(((e,r)=>{p.has(r)||(h.has(r)?t(e,n):o(e))}))}else"close"===e&&(o(b.overlay),o(b.modal),o(b.dashboard),s(b.modal,".error"),s(b.dashboard,".error"),c(b.form),c(b.formEdit),r(document.body,".with-icon > input",this.deleteVisibilityPassword,!0),b.characters.forEach((e=>l(e,"0"))))};disconnect=e=>{this.showToast(e.message,!1),o(b.headerNickname)};updateInterfaceProfile=e=>{const{name:t}=e.user;l(b.nickname,` ${t}, `),this.showToast(e.message),b.buttonGetBooks.click()};render=e=>{const{data:t,type:o,id:r}=e.user,a=document.createDocumentFragment();if(!(t.length||t&&"profile"===o))return a.appendChild(g.messageDefault()),void m[parseInt(r)].replaceChildren(a);"profile"!==o?t&&(t.forEach((e=>{switch(o){case"users":a.appendChild(g.user(e));break;case"books":a.appendChild(g.book(e));break;case"traders":a.appendChild(g.trader(e));break;case"upload-books":a.appendChild(g.bookDashboard(e));break;case"request-books":a.appendChild(g.requestedBookDashboard(e));break;case"notifications":a.appendChild(g.notifications(e))}})),m[parseInt(r)].replaceChildren(a)):this.renderProfile(t)};visibilityPassword=e=>{if(e.classList.contains("visibility")){const t=e.previousElementSibling;t.type="password"===t.type?"text":"password"}};deleteVisibilityPassword=e=>{"text"===e.type&&(e.type="password")};renderProfile=e=>{for(const t in e)b.formEdit.hasOwnProperty(`edit-${t}`)&&(b.formEdit[`edit-${t}`].value=e[t]||"not info")};showModalTrader=e=>{if(!e.target.closest(".item"))return;const{from:t,book:o}=e.target.closest(".item").dataset;if(!t||!o)return;const r=h(3,void 0,void 0,b.modalTitle,"Requested Book",!0,!0,"Send");this.toggleModalOrContainer("open",r),b.form["requested-book"].value=u(o),b.form["requested-user"].value=t};disappearEl=e=>{e.classList.add("disappear"),i(e,"350")}},w="https://library-trader.onrender.com/",k=function(){const e={req:""};return{setEndpoint:t=>e.req=t,getEndpoint:()=>e}}();const v=async(e,t=null)=>{k.setEndpoint(e);try{const e=await(async e=>{try{const t=await fetch(`${w}${e}`,{method:"GET",credentials:"include"});if(!t.ok){const e=await t.json();throw new Error(e.error)}return t.json()}catch(e){throw console.error(e.message),"Failed to fetch"===e.message&&(e.message=""),e.message}})(k.getEndpoint().req);e.success&&t&&t(e)}catch(e){y.showToast(e,!0)}},E=async(e,t,o=null,r=null,a=!1,n,s)=>{e.preventDefault(),k.setEndpoint(o);try{const e=await(async(e,t)=>{try{const o=await fetch(`${w}${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(!o.ok){const e=await o.json();throw new Error(e.error)}return o.json()}catch(e){throw console.error(e.message),console.log(e),"Failed to fetch"===e.message&&(e.message=""),e.message}})(t,k.getEndpoint().req);e.success&&r&&r(e)}catch(e){a?y.showToast(e,!0):y.showError(e,n,s)}},_=async(e,t=null)=>{k.setEndpoint(e);try{const e=await(async e=>{try{const t=await fetch(`${w}${e}`,{method:"DELETE",credentials:"include"});if(!t.ok){const e=await t.json();throw new Error(e.error)}return t.json()}catch(e){throw console.error(e),"Failed to fetch"===e.message&&(e.message=""),e.message}})(k.getEndpoint().req);e.success&&t&&t(e)}catch(e){y.showToast(e,!0)}},C=()=>{v("user/profile?section=notifications",(({user:e})=>{e.data.length?b.buttonNotifications.classList.add("with-notification"):b.buttonNotifications.classList.remove("with-notification")}))};b.form.addEventListener("submit",(e=>(async(e,t,o=null,r=!1,a=null)=>{e.preventDefault(),a&&k.setEndpoint(a);const{req:n}=k.getEndpoint();try{const e=await(async(e,t)=>{try{const o=await fetch(`${w}${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(!o.ok){const e=await o.json();throw new Error(e.error)}return o.json()}catch(e){throw console.error(e.message),"Failed to fetch"===e.message&&(e.message=""),e.message}})(t,n);e.success&&o&&o(e)}catch(e){r?y.showToast(e,!0):y.showError(e,b.modal,b.form)}})(e,a(b.form),y.showFeedbackSuccessfuly))),b.btnLogout.addEventListener("click",(()=>v("logout",y.disconnect))),b.groupLibraryBTN.addEventListener("click",(e=>{const{fetch:t,open:o}=e.target.dataset;if(!t||!o)return;const r=e.target.textContent;v(t,(e=>{const t=h(o,[4,5,6],"grid",b.titleLibrary,"books"===r.toLowerCase()?`${r} available for trade`:`Alls ${r}`,!1);y.toggleModalOrContainer("open",t),y.render(e)}))})),b.formEdit.addEventListener("submit",(e=>E(e,a(b.formEdit),"user/profile/edit",y.updateInterfaceProfile,!1,b.formEdit,b.fieldsetFormEdit))),b.singBTN.addEventListener("click",(()=>{const e=h([0,1],void 0,void 0,b.modalTitle,"Create Account",void 0,!0,"Sign Up");y.toggleModalOrContainer("open",e),k.setEndpoint("register")})),b.logBTN.addEventListener("click",(()=>{const e=h(0,void 0,void 0,b.modalTitle,"Log In",void 0,!0,"Continue");y.toggleModalOrContainer("open",e),k.setEndpoint("login")})),b.addBookBTN.addEventListener("click",(()=>{const e=h(2,void 0,void 0,b.modalTitle,"Create new Book",void 0,!0,"Send Book");y.toggleModalOrContainer("open",e),k.setEndpoint("register/book")})),b.nickname.addEventListener("click",(e=>{const t=h(4);y.toggleModalOrContainer("open",t),C(),b.buttonProfile.click()})),b.library.addEventListener("click",(e=>{k.setEndpoint("requested/book"),y.showModalTrader(e)})),b.dashboard.addEventListener("click",(e=>{if(e.target.classList.contains("close-modal"))return void y.toggleModalOrContainer("close");y.visibilityPassword(e.target),(async e=>{const t=e.target.dataset?.action;if(!t)return;const{book:o}=e.target.parentElement.dataset;if(!o)return;let r,a;"delete-book"===t?(r="book",a="Are you sure you want to delete this book? All associated trades will be canceled"):"cancel-trader"===t&&(r="trader",a=`You are about to cancel the request for the book "${o}". Do you agree?`);try{const t=await g.popupConfirm(a);_(`user/profile/delete/${r}/${o}`,(o=>{y.showFeedbackSuccessfuly(o,!1,!0),y.disappearEl(e.target.parentElement),C(),t.remove()}))}catch(e){e.remove()}})(e),(async e=>{const t=e.target.dataset?.action;if("delete-book"===t||"cancel-trader"===t)return;if(!t)return;const{request:o,type:r}=e.target.closest("li.notification").dataset;if(o&&r){if("resolve-trader"===t)try{const a=await g.popupConfirm("Confirm exchange? The book will be shared with the other user");return E(e,{book:o,type:r},`trader/${t}`,(e=>{C(),y.showFeedbackSuccessfuly(e,!1,!0)})),void a.remove()}catch(e){return void e.remove()}E(e,{book:o,type:r},`trader/${t}`,(e=>{C(),y.showFeedbackSuccessfuly(e,!1,!0)}))}})(e);const{fetch:t,open:o}=e.target.dataset;t&&v(`user/profile?section=${t}`,(t=>{const r=h(o,[4,8,7],void 0,b.titleDashboard,e.target.textContent||"Profile",!0);y.toggleModalOrContainer("open",r),y.render(t)}))})),b.form["book-description"].addEventListener("input",(e=>l(b.characters[0],e.target.value.length))),b.form["requested-message"].addEventListener("input",(e=>l(b.characters[1],e.target.value.length))),b.eyeVisibilityForm.addEventListener("click",(e=>y.visibilityPassword(e.target))),window.addEventListener("load",(e=>{v("auth/status",(e=>y.showFeedbackSuccessfuly(e,!1,!1))),b.buttonGetBooks.click()})),b.closeModal.addEventListener("click",(e=>y.toggleModalOrContainer("close"))),b.overlay.addEventListener("click",(e=>{e.target.closest("#dashboard")||e.target.closest('[class *="modal"]')||y.toggleModalOrContainer("close")}))}();
//# sourceMappingURL=main.js.map